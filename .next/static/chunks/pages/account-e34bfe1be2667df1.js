(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[966],{5458:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/account",function(){return a(4475)}])},4475:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return Account}});var i=a(5893),n=a(7294),r=a(1163),s=a.n(r),o=a(3431),l=a(5379),d=a.n(l),c=a(8643);function MusicSelector(e){var t;let{user:a,onMusicChange:r}=e,[s,o]=(0,n.useState)((null==a?void 0:null===(t=a.preferences)||void 0===t?void 0:t.notificationMusic)||"music1.mp3"),[l,p]=(0,n.useState)(!1),[u,m]=(0,n.useState)(null);(0,n.useRef)(null),(0,n.useEffect)(()=>{var e;(null==a?void 0:null===(e=a.preferences)||void 0===e?void 0:e.notificationMusic)&&o(a.preferences.notificationMusic)},[a]),(0,n.useEffect)(()=>(c.Z.preloadAllNotificationMusic().then(e=>{let t=e.filter(e=>!e.success);t.length>0&&console.warn("Some audio files failed to preload:",t)}),()=>{c.Z.stopCurrentAudio()}),[]);let handleMusicChange=async e=>{var t,i;o(e);try{let i=await fetch("/api/user/music-preference",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({notificationMusic:e})});if(i.ok){let e=await i.json();r&&r(e.user)}else{let e=await i.json();alert(e.error||"Failed to save music preference"),o((null==a?void 0:null===(t=a.preferences)||void 0===t?void 0:t.notificationMusic)||"music1.mp3")}}catch(e){console.error("Error saving music preference:",e),alert("Network error while saving music preference"),o((null==a?void 0:null===(i=a.preferences)||void 0===i?void 0:i.notificationMusic)||"music1.mp3")}},handlePreview=async e=>{if(l&&u===e){c.Z.stopCurrentAudio(),p(!1),m(null);return}try{m(e),p(!0);let t=await c.Z.playAudio(e,{volume:.7,loop:!1,stopCurrent:!0});t.onended=()=>{p(!1),m(null)}}catch(e){console.error("Error playing audio:",e),p(!1),m(null),e.message.includes("not supported")?alert("Audio playback is not supported in your browser."):e.message.includes("Could not load")?alert("Could not load the audio file. Please check if the file exists."):alert("Could not play audio file. Your browser may not support this audio format.")}};return(0,i.jsxs)("div",{style:{marginTop:"24px",padding:"20px",background:"var(--card-secondary)",borderRadius:"16px",border:"1px solid var(--glass-border)"},className:"jsx-c2d7322d52b9fc50",children:[(0,i.jsx)("h4",{style:{marginTop:0,marginBottom:"16px",background:"linear-gradient(135deg, var(--theme-accent), var(--theme-primary))",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text",fontSize:"18px",fontWeight:"700",display:"flex",alignItems:"center",gap:"8px"},className:"jsx-c2d7322d52b9fc50",children:"\uD83C\uDFB5 Notification Music"}),(0,i.jsx)("div",{style:{fontSize:"14px",color:"var(--muted)",marginBottom:"16px",lineHeight:"1.4"},className:"jsx-c2d7322d52b9fc50",children:"Choose your preferred notification sound for confirmations and alerts."}),(0,i.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},className:"jsx-c2d7322d52b9fc50",children:[{value:"music1.mp3",label:"Classic Bell"},{value:"music2.mp3",label:"Gentle Chime"},{value:"music3.mp3",label:"Digital Beep"},{value:"music4.mp3",label:"Soft Ding"},{value:"music5.mp3",label:"Notification Pop"},{value:"music6.mp3",label:"Melodic Tone"},{value:"music7.mp3",label:"Alert Sound"}].map(e=>(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"12px 16px",background:s===e.value?"linear-gradient(135deg, var(--theme-primary)15, var(--theme-secondary)15)":"var(--glass)",border:"1px solid ".concat(s===e.value?"var(--theme-primary)40":"var(--glass-border)"),borderRadius:"12px",cursor:"pointer",transition:"all 0.3s ease",position:"relative"},onClick:()=>handleMusicChange(e.value),className:"jsx-c2d7322d52b9fc50",children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"12px"},className:"jsx-c2d7322d52b9fc50",children:[(0,i.jsx)("div",{style:{width:"20px",height:"20px",borderRadius:"50%",border:"2px solid ".concat(s===e.value?"var(--theme-primary)":"var(--muted)"),background:s===e.value?"var(--theme-primary)":"transparent",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.3s ease"},className:"jsx-c2d7322d52b9fc50",children:s===e.value&&(0,i.jsx)("div",{style:{width:"8px",height:"8px",borderRadius:"50%",background:"white"},className:"jsx-c2d7322d52b9fc50"})}),(0,i.jsx)("span",{style:{fontWeight:s===e.value?"600":"500",color:s===e.value?"var(--theme-primary)":"var(--primary)",fontSize:"14px"},className:"jsx-c2d7322d52b9fc50",children:e.label})]}),(0,i.jsx)("button",{onClick:t=>{t.stopPropagation(),handlePreview(e.value)},style:{width:"36px",height:"36px",borderRadius:"8px",border:"none",background:l&&u===e.value?"linear-gradient(135deg, var(--theme-accent), var(--theme-primary))":"var(--glass)",color:l&&u===e.value?"white":"var(--primary)",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"14px",transition:"all 0.3s ease",boxShadow:l&&u===e.value?"0 4px 12px var(--theme-primary)30":"none"},title:l&&u===e.value?"Stop preview":"Play preview",className:"jsx-c2d7322d52b9fc50",children:l&&u===e.value?"⏹️":"▶️"})]},e.value))}),(0,i.jsx)("div",{style:{marginTop:"12px",fontSize:"12px",color:"var(--muted)",textAlign:"center",lineHeight:"1.4"},className:"jsx-c2d7322d52b9fc50",children:"Click on any option to select it, or use the play button to preview the sound."}),(0,i.jsx)(d(),{id:"c2d7322d52b9fc50",children:'@media(max-width:768px){div[style*="display: flex"][style*="justify-content: space-between"].jsx-c2d7322d52b9fc50{padding:14px 16px!important}div[style*="display: flex"][style*="gap: 12px"].jsx-c2d7322d52b9fc50 span.jsx-c2d7322d52b9fc50{font-size:15px!important}button[style*="width: 36px"].jsx-c2d7322d52b9fc50{width:40px!important;height:40px!important;font-size:16px!important}}@media(max-width:600px){div[style*="padding: 20px"].jsx-c2d7322d52b9fc50{padding:16px!important}h4.jsx-c2d7322d52b9fc50{font-size:16px!important}div[style*="display: flex"][style*="justify-content: space-between"].jsx-c2d7322d52b9fc50{padding:12px 14px!important}div[style*="display: flex"][style*="gap: 12px"].jsx-c2d7322d52b9fc50{gap:10px!important}div[style*="display: flex"][style*="gap: 12px"].jsx-c2d7322d52b9fc50 span.jsx-c2d7322d52b9fc50{font-size:14px!important}button[style*="width: 36px"].jsx-c2d7322d52b9fc50{width:38px!important;height:38px!important;font-size:15px!important}}@media(max-width:480px){div[style*="padding: 20px"].jsx-c2d7322d52b9fc50{padding:14px!important;-webkit-border-radius:12px!important;-moz-border-radius:12px!important;border-radius:12px!important}h4.jsx-c2d7322d52b9fc50{font-size:15px!important;margin-bottom:12px!important}div[style*="margin-bottom: 16px"].jsx-c2d7322d52b9fc50{margin-bottom:12px!important;font-size:13px!important}div[style*="display: flex"][style*="justify-content: space-between"].jsx-c2d7322d52b9fc50{padding:10px 12px!important;-webkit-border-radius:10px!important;-moz-border-radius:10px!important;border-radius:10px!important}div[style*="width: 20px"][style*="height: 20px"].jsx-c2d7322d52b9fc50{width:18px!important;height:18px!important}div[style*="width: 8px"][style*="height: 8px"].jsx-c2d7322d52b9fc50{width:6px!important;height:6px!important}div[style*="display: flex"][style*="gap: 12px"].jsx-c2d7322d52b9fc50{gap:8px!important}div[style*="display: flex"][style*="gap: 12px"].jsx-c2d7322d52b9fc50 span.jsx-c2d7322d52b9fc50{font-size:13px!important}button[style*="width: 36px"].jsx-c2d7322d52b9fc50{width:34px!important;height:34px!important;font-size:14px!important;-webkit-border-radius:6px!important;-moz-border-radius:6px!important;border-radius:6px!important}div[style*="margin-top: 12px"].jsx-c2d7322d52b9fc50{margin-top:10px!important;font-size:11px!important}}@media(hover:none)and (pointer:coarse){div[style*="cursor: pointer"].jsx-c2d7322d52b9fc50:active{-webkit-transform:scale(.98)!important;-moz-transform:scale(.98)!important;-ms-transform:scale(.98)!important;-o-transform:scale(.98)!important;transform:scale(.98)!important;-webkit-transition:-webkit-transform.1s ease!important;-moz-transition:-moz-transform.1s ease!important;-o-transition:-o-transform.1s ease!important;transition:-webkit-transform.1s ease!important;transition:-moz-transform.1s ease!important;transition:-o-transform.1s ease!important;transition:transform.1s ease!important}button.jsx-c2d7322d52b9fc50:active{-webkit-transform:scale(.9)!important;-moz-transform:scale(.9)!important;-ms-transform:scale(.9)!important;-o-transform:scale(.9)!important;transform:scale(.9)!important;-webkit-transition:-webkit-transform.1s ease!important;-moz-transition:-moz-transform.1s ease!important;-o-transition:-o-transform.1s ease!important;transition:-webkit-transform.1s ease!important;transition:-moz-transform.1s ease!important;transition:-o-transform.1s ease!important;transition:transform.1s ease!important}}@media(-webkit-min-device-pixel-ratio:2),(min-resolution:192dpi),(min--moz-device-pixel-ratio:2){button.jsx-c2d7322d52b9fc50{-webkit-font-smoothing:antialiased!important;-moz-osx-font-smoothing:grayscale!important}}'})]})}var p=a(8874);function EnhancedConfirmationDialog(e){let[t,a]=(0,n.useState)("music1.mp3");return(0,n.useEffect)(()=>{let fetchUserPreference=async()=>{try{var e,t;let i=await fetch("/api/me"),n=await i.json();i.ok&&(null===(t=n.user)||void 0===t?void 0:null===(e=t.preferences)||void 0===e?void 0:e.notificationMusic)&&a(n.user.preferences.notificationMusic)}catch(e){console.warn("Could not fetch user music preference:",e)}};e.isOpen&&fetchUserPreference()},[e.isOpen]),(0,i.jsx)(p.Z,{...e,userMusicPreference:t,playNotificationSound:!0})}function NotificationDemo(){let[e,t]=(0,n.useState)(!1),[a,r]=(0,n.useState)("default"),handleShowDialog=e=>{r(e),t(!0)};return(0,i.jsxs)("div",{style:{padding:"24px",background:"var(--card)",borderRadius:"16px",border:"1px solid var(--glass-border)",maxWidth:"400px",margin:"20px auto"},children:[(0,i.jsx)("h3",{style:{marginTop:0,marginBottom:"16px",background:"linear-gradient(135deg, var(--theme-primary), var(--theme-secondary))",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text",fontSize:"18px",fontWeight:"700"},children:"\uD83D\uDD14 Notification Demo"}),(0,i.jsx)("p",{style:{fontSize:"14px",color:"var(--muted)",marginBottom:"20px",lineHeight:"1.4"},children:"Test the notification system with your selected music. Each dialog will play your chosen notification sound."}),(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:[(0,i.jsx)("button",{className:"btn",onClick:()=>handleShowDialog("default"),style:{background:"linear-gradient(135deg, var(--theme-primary), var(--theme-secondary))",color:"white",border:"none",padding:"12px 16px",borderRadius:"8px",fontSize:"14px",fontWeight:"500",cursor:"pointer"},children:"\uD83D\uDD14 Default Notification"}),(0,i.jsx)("button",{className:"btn",onClick:()=>handleShowDialog("success"),style:{background:"linear-gradient(135deg, #22c55e, #16a34a)",color:"white",border:"none",padding:"12px 16px",borderRadius:"8px",fontSize:"14px",fontWeight:"500",cursor:"pointer"},children:"✅ Success Notification"}),(0,i.jsx)("button",{className:"btn",onClick:()=>handleShowDialog("danger"),style:{background:"linear-gradient(135deg, #ef4444, #dc2626)",color:"white",border:"none",padding:"12px 16px",borderRadius:"8px",fontSize:"14px",fontWeight:"500",cursor:"pointer"},children:"⚠️ Warning Notification"})]}),(0,i.jsx)(EnhancedConfirmationDialog,{isOpen:e,onConfirm:()=>{t(!1),alert("Action confirmed!")},onCancel:()=>{t(!1)},...(()=>{switch(a){case"success":return{title:"Success!",message:"Your action was completed successfully.",confirmText:"Great!",type:"success"};case"danger":return{title:"Are you sure?",message:"This action cannot be undone. Please confirm that you want to proceed.",confirmText:"Delete",type:"danger"};default:return{title:"Confirm Action",message:"Please confirm that you want to proceed with this action.",confirmText:"Confirm",type:"default"}}})()})]})}function Account(){let[e,t]=(0,n.useState)(null),[a,r]=(0,n.useState)(null),[l,d]=(0,n.useState)(!1),[c,p]=(0,n.useState)(""),[u,m]=(0,n.useState)(""),[x,h]=(0,n.useState)(!1),[f,g]=(0,n.useState)(!1);async function sendHeartbeat(){try{await fetch("/api/heartbeat",{method:"POST"})}catch(e){console.log("Heartbeat failed:",e)}}async function fetchMe(){let e=await fetch("/api/me"),a=await e.json();if(!a.user){s().push("/");return}t(a.user),r(a.user.avatar||null)}async function handleLogout(){try{g(!0),await fetch("/api/logout",{method:"POST"}),s().push("/")}catch(e){console.error("logout error",e),s().push("/")}finally{g(!1)}}async function handleDeleteAccount(){try{let e=confirm("Delete your account? This is irreversible. Type OK to continue.");if(!e)return;let t=prompt("Please enter your password to confirm account deletion:");if(!t){alert("Deletion cancelled — password required.");return}g(!0);let a=await fetch("/api/delete-account",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:t})});if(a.ok)alert("Account deleted. You will be redirected to the home page."),s().push("/");else{let e=await a.json().catch(()=>({error:"Unknown error"}));alert(e.error||"Could not delete account")}}catch(e){console.error("delete account error",e),alert("Error deleting account")}finally{g(!1)}}async function handleUploadAvatar(e){let t=e.target.files&&e.target.files[0];if(!t)return;let a=new FileReader;a.onload=async e=>{let t=e.target.result;r(t),d(!0);let a=await fetch("/api/avatar",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({avatar:t})});if(d(!1),a.ok)fetchMe(),alert("Avatar updated");else{let e=await a.json().catch(()=>({error:"Unknown"}));alert(e.error||"Could not update avatar")}},a.readAsDataURL(t)}async function handleChangePassword(e){if(e.preventDefault(),!c||!u){alert("Provide both current and new password.");return}let t=await fetch("/api/change-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({currentPassword:c,newPassword:u})});if(t.ok)alert("Password changed successfully"),p(""),m("");else{let e=await t.json().catch(()=>({error:"Unknown"}));alert(e.error||"Could not change password")}}return((0,n.useEffect)(()=>{fetchMe(),sendHeartbeat();let e=localStorage.getItem("theme");e&&"undefined"!=typeof document&&(["dark","dark-blue","pink","yellow","green"].forEach(e=>{document.documentElement.classList.remove(e)}),"light"!==e&&document.documentElement.classList.add(e));let t=setInterval(sendHeartbeat,3e4);return()=>clearInterval(t)},[]),e)?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(o.Z,{user:e,onUserUpdate:e=>{t(e)}}),(0,i.jsx)("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",padding:24},children:(0,i.jsxs)("div",{className:"card modern-card",style:{maxWidth:900,width:"100%",display:"flex",gap:32,padding:32,flexWrap:"wrap",alignItems:"flex-start"},children:[(0,i.jsxs)("div",{style:{flex:"1 1 280px",minWidth:280},children:[(0,i.jsx)("h3",{style:{marginTop:0,background:"linear-gradient(135deg, var(--theme-primary), var(--theme-secondary))",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text",fontSize:"24px",fontWeight:"700"},children:"\uD83D\uDC64 Account"}),(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[(0,i.jsxs)("div",{style:{display:"flex",gap:16,alignItems:"center",padding:"20px",background:"var(--card-secondary)",borderRadius:"16px",border:"1px solid var(--glass-border)"},children:[(0,i.jsxs)("div",{style:{width:96,height:96,borderRadius:20,overflow:"hidden",background:"linear-gradient(135deg, var(--theme-primary), var(--theme-secondary))",display:"flex",alignItems:"center",justifyContent:"center",position:"relative",boxShadow:"0 8px 25px var(--theme-primary)30"},children:[a?(0,i.jsx)("img",{src:a,alt:"avatar",style:{width:"100%",height:"100%",objectFit:"cover"}}):(0,i.jsx)("div",{style:{fontWeight:700,color:"white",fontSize:"28px"},children:e.name.slice(0,2).toUpperCase()}),(0,i.jsx)("div",{style:{position:"absolute",inset:0,borderRadius:20,background:"linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.1) 50%, transparent 70%)",pointerEvents:"none"}})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{style:{fontWeight:700,fontSize:"20px",marginBottom:"8px"},children:e.name}),(0,i.jsxs)("div",{style:{display:"flex",gap:"16px",alignItems:"center"},children:[(0,i.jsxs)("div",{style:{padding:"6px 12px",background:"linear-gradient(135deg, var(--theme-primary)20, var(--theme-secondary)20)",borderRadius:"8px",fontSize:"14px",fontWeight:"600",color:"var(--theme-primary)"},children:["\uD83C\uDFC6 ",e.points," pts"]}),(0,i.jsxs)("div",{style:{padding:"6px 12px",background:"linear-gradient(135deg, var(--theme-accent)20, var(--theme-primary)20)",borderRadius:"8px",fontSize:"14px",fontWeight:"600",color:"var(--theme-accent)"},children:["\uD83D\uDD25 ",e.streak||0," streak"]})]})]})]}),(0,i.jsxs)("div",{style:{marginTop:16},children:[(0,i.jsx)("label",{className:"small",style:{fontWeight:600,color:"var(--primary)",marginBottom:"8px",display:"block"},children:"Avatar"}),(0,i.jsxs)("div",{className:"modern-file-upload",children:[(0,i.jsx)("input",{type:"file",accept:"image/*",onChange:handleUploadAvatar}),(0,i.jsxs)("div",{className:"file-upload-button",children:[(0,i.jsx)("span",{className:"upload-icon",children:"\uD83D\uDCF8"}),(0,i.jsx)("span",{className:"upload-text",children:"Choose Avatar Image"}),(0,i.jsx)("span",{className:"upload-icon",children:"\uD83D\uDCC1"})]})]}),l&&(0,i.jsxs)("div",{className:"file-upload-status uploading",children:[(0,i.jsx)("span",{className:"status-icon",children:"⏳"}),(0,i.jsx)("span",{children:"Uploading avatar..."})]})]}),(0,i.jsxs)("div",{style:{marginTop:8,display:"flex",flexDirection:"column",gap:8},children:[(0,i.jsx)("button",{className:"btn",onClick:()=>s().push("/dashboard"),disabled:f,children:"Back to Universal Classroom"}),(0,i.jsx)("button",{className:"btn",onClick:handleLogout,disabled:f,children:"Logout"}),(0,i.jsx)("button",{className:"btn",onClick:handleDeleteAccount,style:{background:"#ef4444"},disabled:f,children:"Delete account"})]}),(0,i.jsx)(MusicSelector,{user:e,onMusicChange:e=>{t(e)}}),(0,i.jsx)("div",{style:{marginTop:"24px"},children:(0,i.jsx)(NotificationDemo,{})})]})]}),(0,i.jsxs)("div",{style:{flex:"1 1 400px",minWidth:320},children:[(0,i.jsx)("h4",{style:{marginTop:0,background:"linear-gradient(135deg, var(--theme-secondary), var(--theme-accent))",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text",fontSize:"20px",fontWeight:"700"},children:"\uD83D\uDD10 Change password"}),(0,i.jsxs)("form",{onSubmit:handleChangePassword,style:{display:"flex",flexDirection:"column",gap:8},children:[(0,i.jsxs)("div",{className:"password-desktop-row",children:[(0,i.jsx)("label",{children:"Current password"}),(0,i.jsx)("input",{className:"input",type:x?"text":"password",value:c,onChange:e=>p(e.target.value)})]}),(0,i.jsxs)("div",{className:"password-desktop-row",children:[(0,i.jsx)("label",{children:"New password"}),(0,i.jsx)("input",{className:"input",type:x?"text":"password",value:u,onChange:e=>m(e.target.value)})]}),(0,i.jsxs)("div",{className:"password-input-group",children:[(0,i.jsx)("label",{className:"small",children:"Current password"}),(0,i.jsx)("input",{className:"input",type:x?"text":"password",value:c,onChange:e=>p(e.target.value)})]}),(0,i.jsxs)("div",{className:"password-input-group",children:[(0,i.jsx)("label",{className:"small",children:"New password"}),(0,i.jsx)("input",{className:"input",type:x?"text":"password",value:u,onChange:e=>m(e.target.value)})]}),(0,i.jsxs)("div",{className:"form-actions",children:[(0,i.jsxs)("div",{className:"checkbox-container",children:[(0,i.jsx)("input",{id:"showpass",type:"checkbox",checked:x,onChange:e=>h(e.target.checked)}),(0,i.jsx)("label",{htmlFor:"showpass",className:"small",children:"Show passwords while typing"})]}),(0,i.jsx)("div",{className:"button-container",children:(0,i.jsx)("button",{className:"btn",type:"submit",children:"Change password"})})]}),(0,i.jsx)("div",{className:"small",style:{marginTop:6,color:"#6b7280"},children:"Note: original passwords cannot be shown because they are stored securely as hashes. Use this to set a new password if you forgot it."})]})]})]})})]}):null}}},function(e){e.O(0,[431,774,888,179],function(){return e(e.s=5458)}),_N_E=e.O()}]);