"use strict";(()=>{var e={};e.id=1413,e.ids=[1413],e.modules={8432:e=>{e.exports=require("bcryptjs")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},1721:e=>{e.exports=import("@upstash/redis")},3292:e=>{e.exports=require("fs/promises")},1017:e=>{e.exports=require("path")},9600:(e,s,a)=>{a.a(e,async(e,n)=>{try{a.r(s),a.d(s,{config:()=>m,default:()=>u,routeModule:()=>d});var t=a(1802),r=a(7153),o=a(6249),l=a(3578),i=e([l]);l=(i.then?(await i)():i)[0];let u=(0,o.l)(l,"default"),m=(0,o.l)(l,"config"),d=new t.PagesAPIRouteModule({definition:{kind:r.x.PAGES_API,page:"/api/classrooms/[id]/users",pathname:"/api/classrooms/[id]/users",bundlePath:"",filename:""},userland:l});n()}catch(e){n(e)}})},3578:(e,s,a)=>{a.a(e,async(e,n)=>{try{a.r(s),a.d(s,{default:()=>handler});var t=a(8936),r=a(7078),o=e([t,r]);function calculateOnlineStatus(e){if(!e)return"offline";let s=new Date,a=new Date(e),n=(s-a)/6e4;return n<=5?"online":n<=30?"away":"offline"}async function handler(e,s){if("GET"!==e.method)return s.status(405).json({error:"Method not allowed"});let{id:a}=e.query;try{let e=await (0,r.a7)(a);if(!e)return s.status(404).json({error:"Classroom not found"});let n=await (0,t.p_)(),o=n.filter(s=>!!(e.members.includes(s.id)||s.joinedClassrooms&&s.joinedClassrooms.includes(a)));o.sort((e,s)=>{let a=calculateOnlineStatus(e.lastSeen),n=calculateOnlineStatus(s.lastSeen),t={online:3,away:2,offline:1},r=t[n]-t[a];return 0!==r?r:s.points-e.points||e.name.localeCompare(s.name)});let l=o.map(e=>({id:e.id,name:e.isAnonymous?e.anonymousName||"Anonymous User":e.name,points:e.points,streak:e.streak,lastConfirm:e.lastConfirm,avatar:e.isAnonymous?null:e.avatar||null,lastSeen:e.lastSeen||null,onlineStatus:calculateOnlineStatus(e.lastSeen),isAnonymous:e.isAnonymous||!1,anonymousName:e.anonymousName||null,hasJoinedClassroom:e.joinedClassrooms&&e.joinedClassrooms.includes(a)}));s.json({users:l,classroom:{id:e.id,name:e.name,memberCount:e.members.length,totalParticipants:l.length}})}catch(e){console.error("Error fetching classroom users:",e),s.status(500).json({error:"Internal server error"})}}[t,r]=o.then?(await o)():o,n()}catch(e){n(e)}})}};var s=require("../../../../webpack-api-runtime.js");s.C(e);var __webpack_exec__=e=>s(s.s=e),a=s.X(0,[4222,7316,8936,7078],()=>__webpack_exec__(9600));module.exports=a})();