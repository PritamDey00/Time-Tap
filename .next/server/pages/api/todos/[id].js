"use strict";(()=>{var e={};e.id=8427,e.ids=[8427],e.modules={4802:e=>{e.exports=require("cookie")},9344:e=>{e.exports=require("jsonwebtoken")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},1721:e=>{e.exports=import("@upstash/redis")},3292:e=>{e.exports=require("fs/promises")},1017:e=>{e.exports=require("path")},2241:(e,r,t)=>{t.a(e,async(e,o)=>{try{t.r(r),t.d(r,{config:()=>c,default:()=>u,routeModule:()=>p});var s=t(1802),i=t(7153),n=t(6249),a=t(6877),d=e([a]);a=(d.then?(await d)():d)[0];let u=(0,n.l)(a,"default"),c=(0,n.l)(a,"config"),p=new s.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/todos/[id]",pathname:"/api/todos/[id]",bundlePath:"",filename:""},userland:a});o()}catch(e){o(e)}})},6877:(e,r,t)=>{t.a(e,async(e,o)=>{try{t.r(r),t.d(r,{default:()=>handler});var s=t(7352),i=t(9344),n=t.n(i),a=t(4802),d=e([s]);s=(d.then?(await d)():d)[0];let u=process.env.JWT_SECRET||"dev-secret";async function verifyTodoOwnership(e,r){let t=await (0,s.hL)(),o=t.find(r=>r.id===e);if(!o)throw Error("Todo not found");if(o.userId!==r)throw Error("Access denied");return o}async function handler(e,r){try{let t=function(e){let r=(0,a.parse)(e.headers.cookie||""),t=r.auth;if(!t)throw Error("No token provided");try{return n().verify(t,u)}catch(e){throw Error("Invalid token")}}(e),{id:o}=e.query;if(!o)return r.status(400).json({error:"Todo ID is required"});if(await verifyTodoOwnership(o,t.id),"PATCH"===e.method){let t=e.body,i={};void 0!==t.text&&(i.text=t.text.trim()),void 0!==t.completed&&(i.completed=!!t.completed),void 0!==t.priority&&(i.priority=t.priority);let n=await (0,s.CU)(o,i);return r.status(200).json(n)}if("DELETE"===e.method)return await (0,s.aS)(o),r.status(200).json({success:!0});return r.setHeader("Allow",["PATCH","DELETE"]),r.status(405).json({error:"Method not allowed"})}catch(e){if(console.error("Todo API error:",e),"No token provided"===e.message||"Invalid token"===e.message)return r.status(401).json({error:"Unauthorized"});if("Todo not found"===e.message)return r.status(404).json({error:"Todo not found"});if("Access denied"===e.message)return r.status(403).json({error:"Access denied"});return r.status(500).json({error:"Internal server error"})}}o()}catch(e){o(e)}})}};var r=require("../../../webpack-api-runtime.js");r.C(e);var __webpack_exec__=e=>r(r.s=e),t=r.X(0,[4222,7316,7352],()=>__webpack_exec__(2241));module.exports=t})();