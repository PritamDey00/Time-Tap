"use strict";(()=>{var e={};e.id=4905,e.ids=[4905],e.modules={4802:e=>{e.exports=require("cookie")},9344:e=>{e.exports=require("jsonwebtoken")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},1721:e=>{e.exports=import("@upstash/redis")},3292:e=>{e.exports=require("fs/promises")},1017:e=>{e.exports=require("path")},2316:(e,r,o)=>{o.a(e,async(e,t)=>{try{o.r(r),o.d(r,{config:()=>c,default:()=>u,routeModule:()=>l});var s=o(1802),n=o(7153),a=o(6249),i=o(732),d=e([i]);i=(d.then?(await d)():d)[0];let u=(0,a.l)(i,"default"),c=(0,a.l)(i,"config"),l=new s.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/todos/[id]/toggle",pathname:"/api/todos/[id]/toggle",bundlePath:"",filename:""},userland:i});t()}catch(e){t(e)}})},732:(e,r,o)=>{o.a(e,async(e,t)=>{try{o.r(r),o.d(r,{default:()=>handler});var s=o(7352),n=o(9344),a=o.n(n),i=o(4802),d=e([s]);s=(d.then?(await d)():d)[0];let u=process.env.JWT_SECRET||"dev-secret";async function verifyTodoOwnership(e,r){let o=await (0,s.hL)(),t=o.find(r=>r.id===e);if(!t)throw Error("Todo not found");if(t.userId!==r)throw Error("Access denied");return t}async function handler(e,r){try{let o=function(e){let r=(0,i.parse)(e.headers.cookie||""),o=r.auth;if(!o)throw Error("No token provided");try{return a().verify(o,u)}catch(e){throw Error("Invalid token")}}(e),{id:t}=e.query;if(!t)return r.status(400).json({error:"Todo ID is required"});if("PATCH"!==e.method)return r.setHeader("Allow",["PATCH"]),r.status(405).json({error:"Method not allowed"});{await verifyTodoOwnership(t,o.id);let e=await (0,s.cu)(t);return r.status(200).json(e)}}catch(e){if(console.error("Todo toggle API error:",e),"No token provided"===e.message||"Invalid token"===e.message)return r.status(401).json({error:"Unauthorized"});if("Todo not found"===e.message)return r.status(404).json({error:"Todo not found"});if("Access denied"===e.message)return r.status(403).json({error:"Access denied"});return r.status(500).json({error:"Internal server error"})}}t()}catch(e){t(e)}})}};var r=require("../../../../webpack-api-runtime.js");r.C(e);var __webpack_exec__=e=>r(r.s=e),o=r.X(0,[4222,7316,7352],()=>__webpack_exec__(2316));module.exports=o})();