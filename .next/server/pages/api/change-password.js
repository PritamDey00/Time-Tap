"use strict";(()=>{var e={};e.id=8305,e.ids=[8305],e.modules={8432:e=>{e.exports=require("bcryptjs")},9344:e=>{e.exports=require("jsonwebtoken")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},1721:e=>{e.exports=import("@upstash/redis")},3292:e=>{e.exports=require("fs/promises")},1017:e=>{e.exports=require("path")},2845:(e,r,t)=>{t.a(e,async(e,s)=>{try{t.r(r),t.d(r,{config:()=>c,default:()=>p,routeModule:()=>l});var a=t(1802),o=t(7153),n=t(6249),i=t(913),d=e([i]);i=(d.then?(await d)():d)[0];let p=(0,n.l)(i,"default"),c=(0,n.l)(i,"config"),l=new a.PagesAPIRouteModule({definition:{kind:o.x.PAGES_API,page:"/api/change-password",pathname:"/api/change-password",bundlePath:"",filename:""},userland:i});s()}catch(e){s(e)}})},913:(e,r,t)=>{t.a(e,async(e,s)=>{try{t.r(r),t.d(r,{default:()=>handler});var a=t(9344),o=t.n(a),n=t(8432),i=t.n(n),d=t(8936),p=t(7665),c=e([d]);d=(c.then?(await c)():c)[0];let l=process.env.JWT_SECRET||"dev-secret";async function handler(e,r){try{let t;if((0,p.VX)(e,{endpoint:"change-password"}),"POST"!==e.method)return r.status(405).json({error:"Method not allowed",type:"method",message:"This endpoint only supports POST requests"});let s=e.headers.cookie||"",a=s.split(";").map(e=>e.trim()).find(e=>e.startsWith("auth="));if(!a)throw Error("No token provided");let n=a.split("=")[1];try{t=o().verify(n,l)}catch(e){throw Error("Invalid token")}let{currentPassword:c,newPassword:u}=e.body||{};if(!c||!u)throw Error("Current password and new password are required");let h=await (0,d.GG)(t.name);if(!h)throw Error("User not found");let w=i().compareSync(c,h.passwordHash);if(!w)throw Error("Current password incorrect");let f=i().genSaltSync(8);h.passwordHash=i().hashSync(u,f),await (0,d.Nq)(h),console.log("Password changed successfully:",{userId:h.id,name:h.name}),r.json({success:!0})}catch(s){let t=(0,p.Ts)(e);return t.endpoint="change-password",(0,p.zG)(s,r,t)}}s()}catch(e){s(e)}})}};var r=require("../../webpack-api-runtime.js");r.C(e);var __webpack_exec__=e=>r(r.s=e),t=r.X(0,[4222,7316,8936,7665],()=>__webpack_exec__(2845));module.exports=t})();