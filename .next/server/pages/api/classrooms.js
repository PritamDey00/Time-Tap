"use strict";(()=>{var e={};e.id=9737,e.ids=[9737],e.modules={8432:e=>{e.exports=require("bcryptjs")},9344:e=>{e.exports=require("jsonwebtoken")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},1721:e=>{e.exports=import("@upstash/redis")},3292:e=>{e.exports=require("fs/promises")},1017:e=>{e.exports=require("path")},2560:(e,r,s)=>{s.a(e,async(e,t)=>{try{s.r(r),s.d(r,{config:()=>c,default:()=>d,routeModule:()=>m});var a=s(1802),o=s(7153),i=s(6249),n=s(1502),l=e([n]);n=(l.then?(await l)():l)[0];let d=(0,i.l)(n,"default"),c=(0,i.l)(n,"config"),m=new a.PagesAPIRouteModule({definition:{kind:o.x.PAGES_API,page:"/api/classrooms",pathname:"/api/classrooms",bundlePath:"",filename:""},userland:n});t()}catch(e){t(e)}})},1502:(e,r,s)=>{s.a(e,async(e,t)=>{try{s.r(r),s.d(r,{default:()=>handler});var a=s(9344),o=s.n(a),i=s(7078),n=e([i]);i=(n.then?(await n)():n)[0];let l=process.env.JWT_SECRET||"dev-secret";async function handler(e,r){let s=function(e){let r=e.headers.cookie||"",s=r.split(";").map(e=>e.trim()).find(e=>e.startsWith("auth="));if(!s)return null;let t=s.split("=")[1];try{return o().verify(t,l)}catch(e){return null}}(e);if(!s)return r.status(401).json({error:"Authentication required"});if("GET"===e.method)try{let{search:s}=e.query,t=await (0,i.Lo)();if(s&&"string"==typeof s){let e=s.toLowerCase().trim();t=t.filter(r=>r.name.toLowerCase().includes(e)||r.description&&r.description.toLowerCase().includes(e))}let a=t.map(e=>({id:e.id,name:e.name,description:e.description,avatar:e.avatar,createdBy:e.createdBy,createdAt:e.createdAt,memberCount:e.members.length,members:e.members,isUniversal:e.isUniversal,hasPassword:!!e.passwordHash,settings:{allowAnonymous:e.settings.allowAnonymous,maxMembers:e.settings.maxMembers}}));r.json({classrooms:a})}catch(e){console.error("Error loading classrooms:",e),r.status(500).json({error:"Failed to load classrooms"})}else if("POST"===e.method)try{let{name:t,description:a,avatar:o,password:n,settings:l}=e.body;if(!t||"string"!=typeof t||0===t.trim().length)return r.status(400).json({error:"Name is required"});let d=await (0,i._I)({name:t,description:a,avatar:o,password:n,createdBy:s.id,settings:l}),c={id:d.id,name:d.name,description:d.description,avatar:d.avatar,createdBy:d.createdBy,createdAt:d.createdAt,memberCount:d.members.length,members:d.members,isUniversal:d.isUniversal,hasPassword:!!d.passwordHash,settings:d.settings};r.status(201).json({classroom:c})}catch(e){console.error("Error creating classroom:",e),e.message.includes("Validation failed")||e.message.includes("already exists")?r.status(400).json({error:e.message}):r.status(500).json({error:"Failed to create classroom"})}else r.status(405).json({error:"Method not allowed"})}t()}catch(e){t(e)}})}};var r=require("../../webpack-api-runtime.js");r.C(e);var __webpack_exec__=e=>r(r.s=e),s=r.X(0,[4222,7316,7078],()=>__webpack_exec__(2560));module.exports=s})();