"use strict";(()=>{var e={};e.id=3031,e.ids=[3031],e.modules={8432:e=>{e.exports=require("bcryptjs")},4802:e=>{e.exports=require("cookie")},9344:e=>{e.exports=require("jsonwebtoken")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},1721:e=>{e.exports=import("@upstash/redis")},3292:e=>{e.exports=require("fs/promises")},1017:e=>{e.exports=require("path")},400:(e,t,r)=>{r.a(e,async(e,o)=>{try{r.r(t),r.d(t,{config:()=>l,default:()=>c,routeModule:()=>u});var a=r(1802),s=r(7153),i=r(6249),n=r(9805),d=e([n]);n=(d.then?(await d)():d)[0];let c=(0,i.l)(n,"default"),l=(0,i.l)(n,"config"),u=new a.PagesAPIRouteModule({definition:{kind:s.x.PAGES_API,page:"/api/delete-account",pathname:"/api/delete-account",bundlePath:"",filename:""},userland:n});o()}catch(e){o(e)}})},9805:(e,t,r)=>{r.a(e,async(e,o)=>{try{r.r(t),r.d(t,{default:()=>handler});var a=r(9344),s=r.n(a),i=r(4802),n=r(8936),d=r(7665),c=e([n]);n=(c.then?(await c)():c)[0];let l=process.env.JWT_SECRET||"dev-secret";async function handler(e,t){try{let r;if((0,d.VX)(e,{endpoint:"delete-account"}),"POST"!==e.method)return t.status(405).json({error:"Method not allowed",type:"method",message:"This endpoint only supports POST requests"});let o=e.headers.cookie||"",a=o.split(";").map(e=>e.trim()).find(e=>e.startsWith("auth="));if(!a)throw Error("No token provided");let c=a.split("=")[1];try{r=s().verify(c,l)}catch(e){throw Error("Invalid token")}let{password:u}=e.body||{};if(!u)throw Error("Password required to confirm deletion");let p=await (0,n.GG)(r.name);if(!p)throw Error("User not found");let h=await (0,n.TK)({name:p.name,password:u});if(!h)throw Error("Incorrect password");await (0,n.JS)(p.id),t.setHeader("Set-Cookie",(0,i.serialize)("auth","",{httpOnly:!0,path:"/",sameSite:"lax",maxAge:0})),console.log("Account deleted successfully:",{userId:p.id,name:p.name}),t.json({success:!0})}catch(o){let r=(0,d.Ts)(e);return r.endpoint="delete-account",(0,d.zG)(o,t,r)}}o()}catch(e){o(e)}})}};var t=require("../../webpack-api-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),r=t.X(0,[4222,7316,8936,7665],()=>__webpack_exec__(400));module.exports=r})();