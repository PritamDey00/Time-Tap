"use strict";(()=>{var e={};e.id=4403,e.ids=[4403],e.modules={8432:e=>{e.exports=require("bcryptjs")},9344:e=>{e.exports=require("jsonwebtoken")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},1721:e=>{e.exports=import("@upstash/redis")},3292:e=>{e.exports=require("fs/promises")},1017:e=>{e.exports=require("path")},1382:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.r(t),r.d(t,{config:()=>p,default:()=>d,routeModule:()=>l});var s=r(1802),o=r(7153),i=r(6249),n=r(258),u=e([n]);n=(u.then?(await u)():u)[0];let d=(0,i.l)(n,"default"),p=(0,i.l)(n,"config"),l=new s.PagesAPIRouteModule({definition:{kind:o.x.PAGES_API,page:"/api/avatar",pathname:"/api/avatar",bundlePath:"",filename:""},userland:n});a()}catch(e){a(e)}})},258:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.r(t),r.d(t,{default:()=>handler});var s=r(9344),o=r.n(s),i=r(8936),n=e([i]);i=(n.then?(await n)():n)[0];let u=process.env.JWT_SECRET||"dev-secret";async function handler(e,t){let r;if("POST"!==e.method)return t.status(405).json({error:"Method not allowed"});let a=e.headers.cookie||"",s=a.split(";").map(e=>e.trim()).find(e=>e.startsWith("auth="));if(!s)return t.status(401).json({error:"Not authenticated"});let n=s.split("=")[1];try{r=o().verify(n,u)}catch(e){return t.status(401).json({error:"Invalid token"})}let{avatar:d}=e.body||{};if(!d)return t.status(400).json({error:"No avatar provided"});let p=await (0,i.GG)(r.name);return p?"string"==typeof d&&d.startsWith("data:")?void(p.avatar=d,await (0,i.Nq)(p),t.json({success:!0,avatar:p.avatar})):t.status(400).json({error:"Invalid avatar format"}):t.status(404).json({error:"User not found"})}a()}catch(e){a(e)}})}};var t=require("../../webpack-api-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),r=t.X(0,[4222,7316,8936],()=>__webpack_exec__(1382));module.exports=r})();