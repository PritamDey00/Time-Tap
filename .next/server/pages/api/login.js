"use strict";(()=>{var e={};e.id=4994,e.ids=[4994],e.modules={8432:e=>{e.exports=require("bcryptjs")},4802:e=>{e.exports=require("cookie")},9344:e=>{e.exports=require("jsonwebtoken")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},1721:e=>{e.exports=import("@upstash/redis")},3292:e=>{e.exports=require("fs/promises")},1017:e=>{e.exports=require("path")},1688:(e,t,i)=>{i.a(e,async(e,r)=>{try{i.r(t),i.d(t,{config:()=>p,default:()=>l,routeModule:()=>u});var s=i(1802),a=i(7153),n=i(6249),o=i(8292),d=e([o]);o=(d.then?(await d)():d)[0];let l=(0,n.l)(o,"default"),p=(0,n.l)(o,"config"),u=new s.PagesAPIRouteModule({definition:{kind:a.x.PAGES_API,page:"/api/login",pathname:"/api/login",bundlePath:"",filename:""},userland:o});r()}catch(e){r(e)}})},8292:(e,t,i)=>{i.a(e,async(e,r)=>{try{i.r(t),i.d(t,{default:()=>handler});var s=i(8936),a=i(9344),n=i.n(a),o=i(4802),d=i(7665),l=e([s]);s=(l.then?(await l)():l)[0];let p=process.env.JWT_SECRET||"dev-secret";async function handler(e,t){try{if((0,d.VX)(e,{endpoint:"login"}),"POST"!==e.method)return t.status(405).json({error:"Method not allowed",type:"method",message:"This endpoint only supports POST requests"});let{name:i,password:r}=e.body||{};if(!i||!r)throw Error("Missing name or password");let a="admin"===i&&"admin2007"===r;if(a){let e=n().sign({id:"admin",name:"admin",isAdmin:!0},p,{expiresIn:"7d"});return t.setHeader("Set-Cookie",(0,o.serialize)("auth",e,{httpOnly:!0,path:"/",sameSite:"lax",maxAge:604800})),console.log("Admin login successful"),t.json({user:{id:"admin",name:"admin",points:0,streak:0,isAdmin:!0}})}let l=await (0,s.TK)({name:i,password:r});if(!l)throw Error("Invalid credentials");let u={id:l.id,name:l.name},m=n().sign(u,p,{expiresIn:"7d"});t.setHeader("Set-Cookie",(0,o.serialize)("auth",m,{httpOnly:!0,path:"/",sameSite:"lax",maxAge:604800})),console.log("User login successful:",{userId:l.id,name:l.name}),t.json({user:{id:l.id,name:l.name,points:l.points,streak:l.streak}})}catch(r){let i=(0,d.Ts)(e);return i.endpoint="login",(0,d.zG)(r,t,i)}}r()}catch(e){r(e)}})}};var t=require("../../webpack-api-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),i=t.X(0,[4222,7316,8936,7665],()=>__webpack_exec__(1688));module.exports=i})();