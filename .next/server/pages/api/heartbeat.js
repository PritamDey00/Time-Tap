"use strict";(()=>{var e={};e.id=8609,e.ids=[8609],e.modules={8432:e=>{e.exports=require("bcryptjs")},9344:e=>{e.exports=require("jsonwebtoken")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},1721:e=>{e.exports=import("@upstash/redis")},3292:e=>{e.exports=require("fs/promises")},1017:e=>{e.exports=require("path")},9057:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.r(t),r.d(t,{config:()=>u,default:()=>l,routeModule:()=>p});var s=r(1802),n=r(7153),o=r(6249),i=r(7452),d=e([i]);i=(d.then?(await d)():d)[0];let l=(0,o.l)(i,"default"),u=(0,o.l)(i,"config"),p=new s.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/heartbeat",pathname:"/api/heartbeat",bundlePath:"",filename:""},userland:i});a()}catch(e){a(e)}})},7452:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.r(t),r.d(t,{default:()=>handler});var s=r(9344),n=r.n(s),o=r(8936),i=r(7665),d=e([o]);o=(d.then?(await d)():d)[0];let l=process.env.JWT_SECRET||"dev-secret";async function handler(e,t){try{let r;if((0,i.VX)(e,{endpoint:"heartbeat"}),"POST"!==e.method)return t.status(405).json({error:"Method not allowed",type:"method",message:"This endpoint only supports POST requests"});let a=e.headers.cookie||"",s=a.split(";").map(e=>e.trim()).find(e=>e.startsWith("auth="));if(!s)throw Error("No token provided");let d=s.split("=")[1];try{r=n().verify(d,l)}catch(e){throw Error("Invalid token")}if(r.isAdmin)return console.log("Heartbeat skipped for admin user:",{userId:r.id}),t.json({success:!0,message:"Admin user - no heartbeat tracking"});let u=await (0,o.GG)(r.name);if(!u)throw Error("User not found");u.lastSeen=new Date().toISOString(),await (0,o.Nq)(u),console.log("Heartbeat updated successfully:",{userId:u.id,lastSeen:u.lastSeen}),t.json({success:!0,lastSeen:u.lastSeen})}catch(a){let r=(0,i.Ts)(e);return r.endpoint="heartbeat",(0,i.zG)(a,t,r)}}a()}catch(e){a(e)}})}};var t=require("../../webpack-api-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),r=t.X(0,[4222,7316,8936,7665],()=>__webpack_exec__(9057));module.exports=r})();