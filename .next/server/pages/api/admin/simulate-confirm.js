"use strict";(()=>{var e={};e.id=7751,e.ids=[7751],e.modules={8432:e=>{e.exports=require("bcryptjs")},9344:e=>{e.exports=require("jsonwebtoken")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},1721:e=>{e.exports=import("@upstash/redis")},3292:e=>{e.exports=require("fs/promises")},1017:e=>{e.exports=require("path")},325:(e,t,r)=>{r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{config:()=>d,default:()=>l,routeModule:()=>c});var a=r(1802),n=r(7153),i=r(6249),o=r(6478),u=e([o]);o=(u.then?(await u)():u)[0];let l=(0,i.l)(o,"default"),d=(0,i.l)(o,"config"),c=new a.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/admin/simulate-confirm",pathname:"/api/admin/simulate-confirm",bundlePath:"",filename:""},userland:o});s()}catch(e){s(e)}})},6478:(e,t,r)=>{r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{default:()=>handler});var a=r(9344),n=r.n(a),i=r(8936),o=e([i]);i=(o.then?(await o)():o)[0];let u=process.env.JWT_SECRET||"dev-secret";async function handler(e,t){let r;if("POST"!==e.method){t.status(405).json({error:"Method not allowed"});return}let s=e.headers.cookie||"",a=s.split(";").map(e=>e.trim()).find(e=>e.startsWith("auth="));if(!a){t.status(401).json({error:"Not authenticated"});return}let o=a.split("=")[1];try{r=n().verify(o,u)}catch(e){t.status(401).json({error:"Invalid token"});return}let l=await (0,i.GG)(r.name);if(!l){t.status(404).json({error:"User not found"});return}let{scenario:d}=e.body,c=Date.now();switch(d){case"successful-confirm":let p=1;l.streak&&l.streak>0?(p=2,l.streak=l.streak+1):l.streak=1,l.points=(l.points||0)+p,l.lastConfirm=new Date(c).toISOString();break;case"missed-window":l.streak=0,l.lastConfirm=new Date(c).toISOString();break;case"build-streak":l.streak=5,l.points=(l.points||0)+10,l.lastConfirm=new Date(c-21e5).toISOString();break;case"new-user":l.points=0,l.streak=0,l.lastConfirm=null;break;default:return t.status(400).json({error:"Invalid scenario"})}let m=await (0,i.Nq)(l);t.json({success:!0,scenario:d,user:{id:m.id,name:m.name,points:m.points,streak:m.streak,lastConfirm:m.lastConfirm}})}s()}catch(e){s(e)}})}};var t=require("../../../webpack-api-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),r=t.X(0,[4222,7316,8936],()=>__webpack_exec__(325));module.exports=r})();