"use strict";(()=>{var e={};e.id=833,e.ids=[833],e.modules={8432:e=>{e.exports=require("bcryptjs")},9344:e=>{e.exports=require("jsonwebtoken")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},1721:e=>{e.exports=import("@upstash/redis")},3292:e=>{e.exports=require("fs/promises")},1017:e=>{e.exports=require("path")},7206:(e,t,r)=>{r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{config:()=>l,default:()=>p,routeModule:()=>u});var a=r(1802),i=r(7153),o=r(6249),n=r(3525),d=e([n]);n=(d.then?(await d)():d)[0];let p=(0,o.l)(n,"default"),l=(0,o.l)(n,"config"),u=new a.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/admin/test-points",pathname:"/api/admin/test-points",bundlePath:"",filename:""},userland:n});s()}catch(e){s(e)}})},3525:(e,t,r)=>{r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{default:()=>handler});var a=r(9344),i=r.n(a),o=r(8936),n=r(7665),d=e([o]);o=(d.then?(await d)():d)[0];let p=process.env.JWT_SECRET||"dev-secret";async function handler(e,t){try{let r;if((0,n.VX)(e,{endpoint:"admin/test-points"}),"POST"!==e.method)return t.status(405).json({error:"Method not allowed",type:"method",message:"This endpoint only supports POST requests"});let s=e.headers.cookie||"",a=s.split(";").map(e=>e.trim()).find(e=>e.startsWith("auth="));if(!a)throw Error("No token provided");let d=a.split("=")[1];try{r=i().verify(d,p)}catch(e){throw Error("Invalid token")}let l=await (0,o.GG)(r.name);if(!l)throw Error("User not found");let{action:u,points:c,streak:h}=e.body;if(!u)throw Error("Action is required");switch(u){case"add-points":l.points=(l.points||0)+(c||1);break;case"set-points":l.points=c||0;break;case"set-streak":l.streak=h||0;break;case"reset-all":l.points=0,l.streak=0,l.lastConfirm=null;break;default:throw Error("Invalid action")}let m=await (0,o.Nq)(l);console.log("Test points updated:",{userId:m.id,action:u,points:m.points,streak:m.streak}),t.json({success:!0,user:{id:m.id,name:m.name,points:m.points,streak:m.streak,lastConfirm:m.lastConfirm}})}catch(s){let r=(0,n.Ts)(e);return r.endpoint="admin/test-points",(0,n.zG)(s,t,r)}}s()}catch(e){s(e)}})}};var t=require("../../../webpack-api-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),r=t.X(0,[4222,7316,8936,7665],()=>__webpack_exec__(7206));module.exports=r})();