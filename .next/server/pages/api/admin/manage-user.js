"use strict";(()=>{var e={};e.id=3267,e.ids=[3267],e.modules={8432:e=>{e.exports=require("bcryptjs")},9344:e=>{e.exports=require("jsonwebtoken")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},1721:e=>{e.exports=import("@upstash/redis")},3292:e=>{e.exports=require("fs/promises")},1017:e=>{e.exports=require("path")},8697:(e,r,s)=>{s.a(e,async(e,t)=>{try{s.r(r),s.d(r,{config:()=>l,default:()=>u,routeModule:()=>p});var a=s(1802),i=s(7153),o=s(6249),n=s(3222),d=e([n]);n=(d.then?(await d)():d)[0];let u=(0,o.l)(n,"default"),l=(0,o.l)(n,"config"),p=new a.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/admin/manage-user",pathname:"/api/admin/manage-user",bundlePath:"",filename:""},userland:n});t()}catch(e){t(e)}})},3222:(e,r,s)=>{s.a(e,async(e,t)=>{try{s.r(r),s.d(r,{default:()=>handler});var a=s(9344),i=s.n(a),o=s(8936),n=s(7665),d=e([o]);o=(d.then?(await d)():d)[0];let u=process.env.JWT_SECRET||"dev-secret";async function handler(e,r){try{let s;if((0,n.VX)(e,{endpoint:"admin/manage-user"}),"POST"!==e.method)return r.status(405).json({error:"Method not allowed",type:"method",message:"This endpoint only supports POST requests"});let t=e.headers.cookie||"",a=t.split(";").map(e=>e.trim()).find(e=>e.startsWith("auth="));if(!a)throw Error("No token provided");let d=a.split("=")[1];try{s=i().verify(d,u)}catch(e){throw Error("Invalid token")}if(!s.isAdmin)throw Error("Admin access required");let{action:l,userId:p,points:c,streak:m}=e.body;if(!l)throw Error("Action is required");switch(l){case"delete-user":if(!p)throw Error("User ID required");await (0,o.JS)(p),console.log("User deleted by admin:",{userId:p,adminId:s.id}),r.json({success:!0,message:"User deleted successfully"});break;case"set-points":if(!p||void 0===c)throw Error("User ID and points required");let h=await (0,o.p_)(),f=h.find(e=>e.id===p);if(!f)throw Error("User not found");f.points=Math.max(0,parseInt(c)),void 0!==m&&(f.streak=Math.max(0,parseInt(m)));let w=await (0,o.Nq)(f);console.log("User points updated by admin:",{userId:p,points:w.points,adminId:s.id}),r.json({success:!0,message:"User updated successfully",user:{id:w.id,name:w.name,points:w.points,streak:w.streak}});break;case"reset-user":if(!p)throw Error("User ID required");let y=await (0,o.p_)(),k=y.find(e=>e.id===p);if(!k)throw Error("User not found");k.points=0,k.streak=0,k.lastConfirm=null;let g=await (0,o.Nq)(k);console.log("User reset by admin:",{userId:p,adminId:s.id}),r.json({success:!0,message:"User reset successfully",user:{id:g.id,name:g.name,points:g.points,streak:g.streak}});break;default:throw Error("Invalid action")}}catch(t){let s=(0,n.Ts)(e);return s.endpoint="admin/manage-user",(0,n.zG)(t,r,s)}}t()}catch(e){t(e)}})}};var r=require("../../../webpack-api-runtime.js");r.C(e);var __webpack_exec__=e=>r(r.s=e),s=r.X(0,[4222,7316,8936,7665],()=>__webpack_exec__(8697));module.exports=s})();