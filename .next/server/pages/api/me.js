"use strict";(()=>{var e={};e.id=8161,e.ids=[8161],e.modules={8432:e=>{e.exports=require("bcryptjs")},9344:e=>{e.exports=require("jsonwebtoken")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},1721:e=>{e.exports=import("@upstash/redis")},3292:e=>{e.exports=require("fs/promises")},1017:e=>{e.exports=require("path")},3038:(e,s,a)=>{a.a(e,async(e,r)=>{try{a.r(s),a.d(s,{config:()=>d,default:()=>u,routeModule:()=>m});var t=a(1802),o=a(7153),i=a(6249),n=a(614),l=e([n]);n=(l.then?(await l)():l)[0];let u=(0,i.l)(n,"default"),d=(0,i.l)(n,"config"),m=new t.PagesAPIRouteModule({definition:{kind:o.x.PAGES_API,page:"/api/me",pathname:"/api/me",bundlePath:"",filename:""},userland:n});r()}catch(e){r(e)}})},614:(e,s,a)=>{a.a(e,async(e,r)=>{try{a.r(s),a.d(s,{default:()=>handler});var t=a(9344),o=a.n(t),i=a(8936),n=a(7078),l=e([i,n]);[i,n]=l.then?(await l)():l;let u=process.env.JWT_SECRET||"dev-secret";async function handler(e,s){let a=e.headers.cookie||"",r=a.split(";").map(e=>e.trim()).find(e=>e.startsWith("auth="));if(!r){s.status(200).json({user:null});return}let t=r.split("=")[1];try{let e=o().verify(t,u),a=await (0,i.GG)(e.name);if(!a)return s.status(200).json({user:null});if(a.joinedClassrooms||(a.joinedClassrooms=[]),!a.joinedClassrooms.includes("universal"))try{a.joinedClassrooms.push("universal"),await (0,i.Nq)(a.id,{joinedClassrooms:a.joinedClassrooms}),await (0,n.addMemberToClassroom)("universal",a.id)}catch(e){console.error("Failed to add user to universal classroom:",e)}let r=a.timezone||"Asia/Kolkata",l={id:a.id,name:a.name,points:a.points,streak:a.streak,lastConfirm:a.lastConfirm,createdAt:a.createdAt,avatar:a.avatar||null,timezone:r,isAnonymous:a.isAnonymous||!1,anonymousName:a.anonymousName||null};s.json({user:l})}catch(e){s.status(200).json({user:null})}}r()}catch(e){r(e)}})}};var s=require("../../webpack-api-runtime.js");s.C(e);var __webpack_exec__=e=>s(s.s=e),a=s.X(0,[4222,7316,8936,7078],()=>__webpack_exec__(3038));module.exports=a})();