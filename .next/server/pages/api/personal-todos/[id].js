"use strict";(()=>{var e={};e.id=509,e.ids=[509],e.modules={4802:e=>{e.exports=require("cookie")},9344:e=>{e.exports=require("jsonwebtoken")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},1721:e=>{e.exports=import("@upstash/redis")},3292:e=>{e.exports=require("fs/promises")},1017:e=>{e.exports=require("path")},6321:(e,t,r)=>{r.a(e,async(e,o)=>{try{r.r(t),r.d(t,{config:()=>l,default:()=>u,routeModule:()=>p});var i=r(1802),d=r(7153),s=r(6249),a=r(7572),n=e([a]);a=(n.then?(await n)():n)[0];let u=(0,s.l)(a,"default"),l=(0,s.l)(a,"config"),p=new i.PagesAPIRouteModule({definition:{kind:d.x.PAGES_API,page:"/api/personal-todos/[id]",pathname:"/api/personal-todos/[id]",bundlePath:"",filename:""},userland:a});o()}catch(e){o(e)}})},7572:(e,t,r)=>{r.a(e,async(e,o)=>{try{r.r(t),r.d(t,{default:()=>handler});var i=r(7352),d=r(9344),s=r.n(d),a=r(4802),n=r(7665),u=e([i]);i=(u.then?(await u)():u)[0];let l=process.env.JWT_SECRET||"dev-secret";async function verifyTodoOwnership(e,t){let r=await (0,i.hL)(),o=r.find(t=>t.id===e);if(!o)throw Error("Todo not found");if(o.userId!==t)throw Error("Access denied");return o}async function handler(e,t){try{console.log("Personal todo [id] API request:",{method:e.method,todoId:e.query.id,timestamp:new Date().toISOString()});let r=function(e){let t=(0,a.parse)(e.headers.cookie||""),r=t.auth;if(!r)throw Error("No token provided");try{return s().verify(r,l)}catch(e){throw Error("Invalid token")}}(e),{id:o}=e.query;if(!o)throw Error("Todo ID is required");if(await verifyTodoOwnership(o,r.id),"PATCH"===e.method){(0,n.Gl)(e,{text:!1,completed:!1,priority:!1});let d=e.body,s=await (0,i.hL)(),a=s.findIndex(e=>e.id===o);if(-1===a)throw Error("Todo not found");let u={};if(void 0!==d.text){if(!d.text.trim())throw Error("Text cannot be empty");u.text=d.text.trim()}return void 0!==d.completed&&(u.completed=!!d.completed),void 0!==d.priority&&(u.priority=d.priority),s[a]={...s[a],...u,updatedAt:new Date().toISOString()},await (0,i.Yr)(s),console.log("Todo updated successfully:",{todoId:o,userId:r.id}),t.status(200).json(s[a])}if("DELETE"!==e.method)return t.setHeader("Allow",["PATCH","DELETE"]),t.status(405).json({error:"Method not allowed",type:"validation",message:"This endpoint only supports PATCH and DELETE methods"});{let e=await (0,i.hL)(),d=e.filter(e=>e.id!==o);return await (0,i.Yr)(d),console.log("Todo deleted successfully:",{todoId:o,userId:r.id}),t.status(200).json({success:!0})}}catch(e){return(0,n.zG)(e,t)}}o()}catch(e){o(e)}})}};var t=require("../../../webpack-api-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),r=t.X(0,[4222,7316,7665,7352],()=>__webpack_exec__(6321));module.exports=r})();