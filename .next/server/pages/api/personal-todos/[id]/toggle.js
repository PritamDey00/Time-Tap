"use strict";(()=>{var e={};e.id=7351,e.ids=[7351],e.modules={4802:e=>{e.exports=require("cookie")},9344:e=>{e.exports=require("jsonwebtoken")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},1721:e=>{e.exports=import("@upstash/redis")},3292:e=>{e.exports=require("fs/promises")},1017:e=>{e.exports=require("path")},8173:(e,t,r)=>{r.a(e,async(e,o)=>{try{r.r(t),r.d(t,{config:()=>u,default:()=>l,routeModule:()=>p});var d=r(1802),i=r(7153),a=r(6249),n=r(2825),s=e([n]);n=(s.then?(await s)():s)[0];let l=(0,a.l)(n,"default"),u=(0,a.l)(n,"config"),p=new d.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/personal-todos/[id]/toggle",pathname:"/api/personal-todos/[id]/toggle",bundlePath:"",filename:""},userland:n});o()}catch(e){o(e)}})},2825:(e,t,r)=>{r.a(e,async(e,o)=>{try{r.r(t),r.d(t,{default:()=>handler});var d=r(7352),i=r(9344),a=r.n(i),n=r(4802),s=r(7665),l=e([d]);d=(l.then?(await l)():l)[0];let u=process.env.JWT_SECRET||"dev-secret";async function verifyTodoOwnership(e,t){let r=await (0,d.hL)(),o=r.find(t=>t.id===e);if(!o)throw Error("Todo not found");if(o.userId!==t)throw Error("Access denied");return o}async function handler(e,t){try{console.log("Personal todo toggle API request:",{method:e.method,todoId:e.query.id,timestamp:new Date().toISOString()});let r=function(e){let t=(0,n.parse)(e.headers.cookie||""),r=t.auth;if(!r)throw Error("No token provided");try{return a().verify(r,u)}catch(e){throw Error("Invalid token")}}(e),{id:o}=e.query;if(!o)throw Error("Todo ID is required");if("PATCH"!==e.method)return t.setHeader("Allow",["PATCH"]),t.status(405).json({error:"Method not allowed",type:"validation",message:"This endpoint only supports PATCH method"});{await verifyTodoOwnership(o,r.id);let e=await (0,d.hL)(),i=e.findIndex(e=>e.id===o);if(-1===i)throw Error("Todo not found");return e[i]={...e[i],completed:!e[i].completed,updatedAt:new Date().toISOString()},await (0,d.Yr)(e),console.log("Todo toggled successfully:",{todoId:o,userId:r.id,completed:e[i].completed}),t.status(200).json(e[i])}}catch(e){return(0,s.zG)(e,t)}}o()}catch(e){o(e)}})}};var t=require("../../../../webpack-api-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),r=t.X(0,[4222,7316,7665,7352],()=>__webpack_exec__(8173));module.exports=r})();