"use strict";exports.id=8936,exports.ids=[8936],exports.modules={8936:(e,t,n)=>{n.a(e,async(e,r)=>{try{n.d(t,{GG:()=>findUserByName,JS:()=>deleteUserById,Nq:()=>updateUser,O4:()=>updateUserMusicPreference,TK:()=>verifyCredentials,bb:()=>toggleUserAnonymousMode,p_:()=>loadUsers,r4:()=>createUser,tj:()=>findUserById});var s=n(8432),a=n.n(s),i=n(7316),o=e([i]);i=(o.then?(await o)():o)[0];let d="users";async function ensureStore(){let e=(0,i.jR)(),t=await e.exists(d);t||await e.set(d,[])}async function loadUsers(){await ensureStore();let e=(0,i.jR)(),t=await e.get(d)||[],n=!1;return t.forEach(e=>{e.preferences||(e.preferences={notificationMusic:"music1.mp3",theme:"light"},n=!0)}),n&&await saveUsers(t),t}async function saveUsers(e){await ensureStore();let t=(0,i.jR)();await t.set(d,e)}async function findUserByName(e){let t=await loadUsers();return t.find(t=>t.name.toLowerCase()===e.toLowerCase())}async function createUser({name:e,password:t}){let r=await loadUsers();if(r.find(t=>t.name.toLowerCase()===e.toLowerCase()))throw Error("already_exists");let s=a().genSaltSync(8),i=a().hashSync(t,s),o={id:Date.now().toString(36),name:e,passwordHash:i,points:0,streak:0,lastConfirm:null,createdAt:new Date().toISOString(),joinedClassrooms:["universal"],isAnonymous:!1,anonymousName:generateAnonymousName(e),avatar:null,preferences:{notificationMusic:"music1.mp3",theme:"light"}};r.push(o),await saveUsers(r);try{let{addMemberToClassroom:e}=await n.e(7078).then(n.bind(n,7078));await e("universal",o.id)}catch(e){console.error("Failed to add user to universal classroom:",e)}return o}async function verifyCredentials({name:e,password:t}){let n=await findUserByName(e);if(!n)return null;let r=a().compareSync(t,n.passwordHash);return r?n:null}async function updateUser(e,t){let n=await loadUsers();if("object"==typeof e&&e.id&&!t){let t=n.findIndex(t=>t.id===e.id);if(-1===t)throw Error("not_found");return n[t]=e,await saveUsers(n),n[t]}let r=n.findIndex(t=>t.id===e);if(-1===r)throw Error("not_found");return n[r]={...n[r],...t},await saveUsers(n),n[r]}async function deleteUserById(e){let t=await loadUsers(),n=t.findIndex(t=>t.id===e);if(-1===n)throw Error("not_found");return t.splice(n,1),await saveUsers(t),!0}function generateAnonymousName(e){let t=["Anonymous","Mystery","Hidden","Secret","Unknown","Phantom","Shadow","Invisible"],n=["Student","Learner","Scholar","User","Participant","Member","Guest","Visitor"],r=e.split("").reduce((e,t)=>(e=(e<<5)-e+t.charCodeAt(0))&e,0),s=Math.abs(r)%t.length,a=Math.abs(r>>8)%n.length;return`${t[s]} ${n[a]} ${Math.abs(r>>16)%1e3}`}async function toggleUserAnonymousMode(e){let t=await loadUsers(),n=t.findIndex(t=>t.id===e);if(-1===n)throw Error("User not found");let r=t[n];return r.isAnonymous=!r.isAnonymous,r.anonymousName||(r.anonymousName=generateAnonymousName(r.name)),t[n]=r,await saveUsers(t),r}async function findUserById(e){let t=await loadUsers();return t.find(t=>t.id===e)}async function updateUserMusicPreference(e,t){let n=await loadUsers(),r=n.findIndex(t=>t.id===e);if(-1===r)throw Error("User not found");let s=n[r];return s.preferences||(s.preferences={notificationMusic:"music1.mp3",theme:"light"}),s.preferences.notificationMusic=t,n[r]=s,await saveUsers(n),s}r()}catch(e){r(e)}})}};