"use strict";exports.id=7078,exports.ids=[7078],exports.modules={7078:(s,o,r)=>{r.a(s,async(s,e)=>{try{r.d(o,{$H:()=>updateClassroom,Lo:()=>loadClassrooms,Xc:()=>verifyClassroomPassword,_I:()=>createClassroom,a7:()=>findClassroomById,addMemberToClassroom:()=>addMemberToClassroom,hg:()=>removeMemberFromClassroom});var a=r(8432),t=r.n(a),n=r(7316),i=s([n]);n=(i.then?(await i)():i)[0];let m=(0,n.ok)();function validateClassroom(s){let o=[];return s.name&&"string"==typeof s.name&&0!==s.name.trim().length||o.push("Name is required and must be a non-empty string"),s.name&&s.name.length>50&&o.push("Name must be 50 characters or less"),s.description&&"string"!=typeof s.description&&o.push("Description must be a string"),s.description&&s.description.length>200&&o.push("Description must be 200 characters or less"),s.password&&"string"!=typeof s.password&&o.push("Password must be a string"),s.avatar&&"string"!=typeof s.avatar&&o.push("Avatar must be a string"),s.settings&&("object"!=typeof s.settings?o.push("Settings must be an object"):(void 0!==s.settings.allowAnonymous&&"boolean"!=typeof s.settings.allowAnonymous&&o.push("Settings.allowAnonymous must be a boolean"),void 0!==s.settings.maxMembers&&(!Number.isInteger(s.settings.maxMembers)||s.settings.maxMembers<1)&&o.push("Settings.maxMembers must be a positive integer"))),o}async function ensureStore(){try{let s=await m.exists("classrooms");if(!s){let s={id:"universal",name:"Universal Classroom",description:"A classroom for everyone to join and interact",avatar:"\uD83C\uDF0D",password:null,createdBy:"system",createdAt:new Date().toISOString(),members:[],isUniversal:!0,settings:{allowAnonymous:!0,maxMembers:1e3}};await m.set("classrooms",[s])}}catch(s){console.error("Error ensuring classroom store:",s),await m.set("classrooms",[])}}async function loadClassrooms(){await ensureStore();try{let s=await m.get("classrooms");return s||[]}catch(s){return console.error("Error loading classrooms:",s),[]}}async function saveClassrooms(s){await ensureStore();try{await m.set("classrooms",s)}catch(s){throw console.error("Error saving classrooms:",s),s}}async function findClassroomById(s){let o=await loadClassrooms();return o.find(o=>o.id===s)}async function createClassroom({name:s,description:o,avatar:r,password:e,createdBy:a,settings:n={}}){let i={name:s?.trim(),description:o?.trim()||"",avatar:r||"\uD83D\uDCDA",password:e,createdBy:a,settings:{allowAnonymous:!0,maxMembers:100,...n}},m=validateClassroom(i);if(m.length>0)throw Error(`Validation failed: ${m.join(", ")}`);let l=await loadClassrooms();if(l.find(s=>s.name.toLowerCase()===i.name.toLowerCase()))throw Error("A classroom with this name already exists");let d={id:Date.now().toString(36)+Math.random().toString(36).substr(2),...i,passwordHash:e?t().hashSync(e,8):null,createdAt:new Date().toISOString(),members:[],isUniversal:!1};return delete d.password,l.push(d),await saveClassrooms(l),d}async function updateClassroom(s,o){let r=await loadClassrooms(),e=r.findIndex(o=>o.id===s);if(-1===e)throw Error("Classroom not found");let a=r[e],n={...o};void 0!==n.password&&(n.passwordHash=n.password?t().hashSync(n.password,8):null,delete n.password);let i={...a,...n},m=validateClassroom(i);if(m.length>0)throw Error(`Validation failed: ${m.join(", ")}`);return r[e]=i,await saveClassrooms(r),r[e]}async function addMemberToClassroom(s,o){let r=await loadClassrooms(),e=r.findIndex(o=>o.id===s);if(-1===e)throw Error("Classroom not found");let a=r[e];if(a.members.includes(o))return a;if(a.settings.maxMembers&&a.members.length>=a.settings.maxMembers)throw Error("Classroom is full");return a.members.push(o),r[e]=a,await saveClassrooms(r),a}async function removeMemberFromClassroom(s,o){let r=await loadClassrooms(),e=r.findIndex(o=>o.id===s);if(-1===e)throw Error("Classroom not found");let a=r[e],t=a.members.indexOf(o);return -1===t||(a.members.splice(t,1),r[e]=a,await saveClassrooms(r)),a}async function verifyClassroomPassword(s,o){let r=await findClassroomById(s);if(!r)throw Error("Classroom not found");return!r.passwordHash||!!o&&t().compareSync(o,r.passwordHash)}e()}catch(s){e(s)}})}};