"use strict";exports.id=7316,exports.ids=[7316],exports.modules={7316:(e,r,t)=>{t.a(e,async(e,s)=>{try{t.d(r,{jR:()=>getStorageAdapter,ok:()=>createStorageAdapter}),t(4358);var i=t(2367),o=e([i]);function createStorageAdapter(){return new i.O}i=(o.then?(await o)():o)[0];let a=null;function getStorageAdapter(){return a||(a=createStorageAdapter()),a}s()}catch(e){s(e)}})},4358:(e,r,t)=>{t.d(r,{p:()=>FilesystemStorageAdapter});var s=t(3292),i=t.n(s),o=t(1017),a=t.n(o);let FilesystemStorageAdapter=class FilesystemStorageAdapter{constructor(){this.dataDir=a().join(process.cwd(),"data")}async ensureDataDir(){try{await i().mkdir(this.dataDir,{recursive:!0})}catch(e){}}getFilePath(e){return a().join(this.dataDir,`${e}.json`)}async get(e){try{await this.ensureDataDir();let r=this.getFilePath(e),t=await i().readFile(r,"utf8");return JSON.parse(t||"null")}catch(r){if("ENOENT"===r.code)return null;if("EACCES"===r.code)return console.error(`Permission denied reading storage key "${e}":`,r.message),null;if(r instanceof SyntaxError)return console.error(`Invalid JSON in storage key "${e}":`,r.message),null;return console.error(`Error reading storage key "${e}":`,r.message),null}}async set(e,r){try{await this.ensureDataDir();let t=this.getFilePath(e),s=t+".tmp";await i().writeFile(s,JSON.stringify(r,null,2)),await i().rename(s,t)}catch(r){try{let r=this.getFilePath(e)+".tmp";await i().unlink(r)}catch(e){}if("EROFS"===r.code)throw console.error(`Read-only filesystem error writing storage key "${e}":`,r.message),Error(`Cannot write to read-only filesystem for key "${e}"`);if("EACCES"===r.code)throw console.error(`Permission denied writing storage key "${e}":`,r.message),Error(`Permission denied writing data for key "${e}"`);if("ENOSPC"===r.code)throw console.error(`No space left on device writing storage key "${e}":`,r.message),Error(`No space left on device for key "${e}"`);throw console.error(`Error writing storage key "${e}":`,r.message),Error(`Failed to store data for key "${e}": ${r.message}`)}}async delete(e){try{let r=this.getFilePath(e);await i().unlink(r)}catch(r){if("ENOENT"===r.code)return;if("EACCES"===r.code)throw console.error(`Permission denied deleting storage key "${e}":`,r.message),Error(`Permission denied deleting data for key "${e}"`);if("EROFS"===r.code)throw console.error(`Read-only filesystem error deleting storage key "${e}":`,r.message),Error(`Cannot delete from read-only filesystem for key "${e}"`);throw console.error(`Error deleting storage key "${e}":`,r.message),Error(`Failed to delete data for key "${e}": ${r.message}`)}}async exists(e){try{let r=this.getFilePath(e);return await i().access(r),!0}catch(r){return"ENOENT"!==r.code&&console.error(`Error checking existence of storage key "${e}":`,r.message),!1}}}},2367:(e,r,t)=>{t.a(e,async(e,s)=>{try{t.d(r,{O:()=>RedisStorageAdapter});var i=t(1721),o=e([i]);i=(o.then?(await o)():o)[0];let RedisStorageAdapter=class RedisStorageAdapter{constructor(){this.redis=null,this.retryConfig={maxRetries:3,baseDelay:100,maxDelay:5e3,backoffMultiplier:2},this.initializeRedis()}initializeRedis(){try{let e=process.env.UPSTASH_REDIS_REST_URL,r=process.env.UPSTASH_REDIS_REST_TOKEN;if(!e||!r)throw console.error("Missing Redis configuration. Required environment variables:"),console.error("- UPSTASH_REDIS_REST_URL"),console.error("- UPSTASH_REDIS_REST_TOKEN"),Error("Redis configuration missing");this.redis=new i.Redis({url:e,token:r}),console.log("Redis storage adapter initialized successfully")}catch(e){throw console.error("Failed to initialize Redis storage adapter:",e.message),e}}ensureRedis(){if(!this.redis)throw Error("Redis not initialized")}isRetryableError(e){let r=e.message.toLowerCase();return["econnrefused","enotfound","timeout","econnreset","epipe","socket hang up","network error","temporary failure","service unavailable","too many requests"].some(e=>r.includes(e))}calculateDelay(e){let r=this.retryConfig.baseDelay*Math.pow(this.retryConfig.backoffMultiplier,e);return Math.min(r,this.retryConfig.maxDelay)}sleep(e){return new Promise(r=>setTimeout(r,e))}async executeWithRetry(e,r,t){let s;for(let i=0;i<=this.retryConfig.maxRetries;i++)try{return await e()}catch(o){if(s=o,i===this.retryConfig.maxRetries||!this.isRetryableError(o))break;let e=this.calculateDelay(i);console.warn(`Redis ${r} failed for key "${t}" (attempt ${i+1}/${this.retryConfig.maxRetries+1}): ${o.message}. Retrying in ${e}ms...`),await this.sleep(e)}throw s}async get(e){try{this.ensureRedis();let r=await this.executeWithRetry(async()=>await this.redis.get(e),"get",e);if(null===r)return null;if("object"==typeof r)return r;try{return JSON.parse(r)}catch(t){return console.error(`JSON parsing failed for storage key "${e}":`,t.message),r}}catch(r){return r.message.includes("ECONNREFUSED")||r.message.includes("ENOTFOUND")?console.error(`Redis connection failed for storage key "${e}":`,r.message):r.message.includes("timeout")?console.error(`Redis timeout reading storage key "${e}":`,r.message):r.message.includes("authentication")?console.error(`Redis authentication failed for storage key "${e}":`,r.message):console.error(`Error reading storage key "${e}":`,r.message),null}}async set(e,r){try{this.ensureRedis(),await this.executeWithRetry(async()=>await this.redis.set(e,r),"set",e)}catch(r){if(r.message.includes("ECONNREFUSED")||r.message.includes("ENOTFOUND"))throw console.error(`Redis connection failed writing storage key "${e}":`,r.message),Error(`Redis connection failed for key "${e}": ${r.message}`);if(r.message.includes("timeout"))throw console.error(`Redis timeout writing storage key "${e}":`,r.message),Error(`Redis timeout for key "${e}": ${r.message}`);if(r.message.includes("authentication"))throw console.error(`Redis authentication failed writing storage key "${e}":`,r.message),Error(`Redis authentication failed for key "${e}": ${r.message}`);if(r.message.includes("memory"))throw console.error(`Redis out of memory writing storage key "${e}":`,r.message),Error(`Redis out of memory for key "${e}": ${r.message}`);else throw console.error(`Error writing storage key "${e}":`,r.message),Error(`Failed to store data for key "${e}": ${r.message}`)}}async delete(e){try{this.ensureRedis(),await this.executeWithRetry(async()=>await this.redis.del(e),"delete",e)}catch(r){if(r.message.includes("ECONNREFUSED")||r.message.includes("ENOTFOUND"))throw console.error(`Redis connection failed deleting storage key "${e}":`,r.message),Error(`Redis connection failed for key "${e}": ${r.message}`);if(r.message.includes("timeout"))throw console.error(`Redis timeout deleting storage key "${e}":`,r.message),Error(`Redis timeout for key "${e}": ${r.message}`);if(r.message.includes("authentication"))throw console.error(`Redis authentication failed deleting storage key "${e}":`,r.message),Error(`Redis authentication failed for key "${e}": ${r.message}`);throw console.error(`Error deleting storage key "${e}":`,r.message),Error(`Failed to delete data for key "${e}": ${r.message}`)}}async exists(e){try{this.ensureRedis();let r=await this.executeWithRetry(async()=>await this.redis.exists(e),"exists",e);return 1===r}catch(r){return r.message.includes("ECONNREFUSED")||r.message.includes("ENOTFOUND")?console.error(`Redis connection failed checking existence of storage key "${e}":`,r.message):r.message.includes("timeout")?console.error(`Redis timeout checking existence of storage key "${e}":`,r.message):r.message.includes("authentication")?console.error(`Redis authentication failed checking existence of storage key "${e}":`,r.message):console.error(`Error checking existence of storage key "${e}":`,r.message),!1}}async healthCheck(){try{return this.ensureRedis(),await this.executeWithRetry(async()=>await this.redis.ping(),"ping","healthcheck"),!0}catch(e){return e.message.includes("ECONNREFUSED")||e.message.includes("ENOTFOUND")?console.error("Redis health check failed - connection refused:",e.message):e.message.includes("timeout")?console.error("Redis health check failed - timeout:",e.message):e.message.includes("authentication")?console.error("Redis health check failed - authentication error:",e.message):console.error("Redis health check failed:",e.message),!1}}};s()}catch(e){s(e)}})}};