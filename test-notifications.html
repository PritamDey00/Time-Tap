<!DOCTYPE html>
<html>
<head>
    <title>Notification Test</title>
</head>
<body>
    <h1>Enhanced Notification System Test</h1>
    <button onclick="testNotifications()">Test Notifications</button>
    <button onclick="testMusic()">Test Background Music</button>
    <div id="status"></div>

    <script>
        function updateStatus(message) {
            document.getElementById('status').innerHTML += '<p>' + message + '</p>';
        }

        function testNotifications() {
            updateStatus('Testing notification system...');
            
            if (!('Notification' in window)) {
                updateStatus('âŒ This browser does not support notifications');
                return;
            }

            if (Notification.permission === 'granted') {
                updateStatus('âœ… Notifications already granted');
                showTestNotification();
            } else if (Notification.permission === 'denied') {
                updateStatus('âŒ Notifications are blocked');
            } else {
                updateStatus('ðŸ”„ Requesting notification permission...');
                Notification.requestPermission().then(permission => {
                    if (permission === 'granted') {
                        updateStatus('âœ… Notification permission granted!');
                        showTestNotification();
                    } else {
                        updateStatus('âŒ Notification permission denied');
                    }
                });
            }
        }

        function showTestNotification() {
            try {
                const notification = new Notification('ðŸŽ¯ Test Notification', {
                    body: 'This is a test of the enhanced notification system!',
                    requireInteraction: true,
                    vibrate: [200, 100, 200],
                    tag: 'test-notification'
                });

                notification.onclick = () => {
                    updateStatus('âœ… Notification clicked!');
                    notification.close();
                };

                updateStatus('ðŸ“¢ Test notification sent!');
            } catch (e) {
                updateStatus('âŒ Error creating notification: ' + e.message);
            }
        }

        function testMusic() {
            updateStatus('Testing background music...');
            
            try {
                const audio = new Audio('/music.mp3');
                audio.volume = 0.3;
                audio.loop = true;
                
                audio.play().then(() => {
                    updateStatus('ðŸŽµ Background music started!');
                    setTimeout(() => {
                        audio.pause();
                        audio.currentTime = 0;
                        updateStatus('ðŸ”‡ Background music stopped');
                    }, 3000);
                }).catch(e => {
                    updateStatus('âŒ Music autoplay blocked: ' + e.message);
                    updateStatus('ðŸ’¡ Try clicking on the page first, then test music');
                });
            } catch (e) {
                updateStatus('âŒ Error with music: ' + e.message);
            }
        }

        // Auto-request permissions on page load
        window.onload = () => {
            updateStatus('ðŸš€ Enhanced notification system loaded');
            updateStatus('ðŸ“± Features:');
            updateStatus('  â€¢ Persistent notifications that stay visible');
            updateStatus('  â€¢ Background music during confirmation window');
            updateStatus('  â€¢ Repeated alerts every 15 seconds');
            updateStatus('  â€¢ Works even when tab is not active');
            updateStatus('  â€¢ Success notifications after confirmation');
            updateStatus('  â€¢ Vibration support on mobile devices');
        };
    </script>
</body>
</html>